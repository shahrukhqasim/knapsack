#!/bin/sh
Fatal() {
	echo "$*" >&2
	exit 1
}
[ $# -eq 1 ] || Fatal "Usage: ${0##*/} [binary]"
cmd=$1
Test() {
	echo "$cmd $*"
	result=`"$cmd" "$@"` || Fatal 'execution failed'
	echo "$result"
}
Check() {
	[ "$result" = "$*" ] || Fatal "failure: result should be
$*"
}
Test '-s3*2' '-s2' '-s2' '-s3' '-s4' '0*2'
Check '16
2|2: 2
2|2: 2
2|2: 2
2|2: 2
2|2: 2
2|3: 2
4|4: 2*2=4'
Test -s1 8
Check '0'
Test -s1 8
Check '0'
Test -s7 1 3 5
Check '6
6|7: 1 5'
Test -s6 9 1 3 5 8
Check '6
6|6: 1 5'
Test -fs 9 '1=1.5' '1=2.5' 1 2 8
Check '10.5
9(10.5)|9: 1(2.5) 8'
Test -s7 '0*8' '0*1' '0*9'
Check '7
7|7: 7*1=7'
Test -s11 '0*3' '0*5' '0*7'
Check '11
11|11: 2*3=6 5'
Test -fs 14 '0*3=3.5' '0*5=7.5' '0*7'
Check '18.5
13(18.5)|14: 3(3.5) 2*5=10(2*7.5=15)'
Test -s8 '1=3' '0*8' '0*4' '0*3' '2=4'
Check '11
7(11)|8: 1(3) 4 2(4)'
Test -s6 -s3 1 2 5
Check '8
5|6: 5
3|3: 1 2'
Test -fs'3*100' '0*4=0.1' '7*1=1.2' '2*17=3.5' '4*51' '0*8=100'
Check '3605
100(1204.8)|100: 4*1=4(4*1.2=4.8) 12*8=96(12*100=1200)
100(1200.1)|100: 4(0.1) 12*8=96(12*100=1200)
100(1200.1)|100: 4(0.1) 12*8=96(12*100=1200)'
Test -fs'3*100' '0*4=0.1' '7*1=1.2' '2*17=3.5' '4*51' '0*8=0.6'
Check '175.7
95(65.3)|100: 4(0.1) 6*1=6(6*1.2=7.2) 2*17=34(2*3.5=7) 51
99(54.6)|100: 51 6*8=48(6*0.6=3.6)
100(55.8)|100: 1(1.2) 51 6*8=48(6*0.6=3.6)'
